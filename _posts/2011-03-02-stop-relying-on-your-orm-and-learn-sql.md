---
layout: post
title: Stop relying on your ORM and learn SQL
published: false
---

In modern development and in particular with web frameworks such as Rails that offers and encourages extensive use of database ORM libraries. With these ORMs it is as if developers think they no longer need to know SQL. The truth is that we are not this fortunate. You should *only* use an ORM if you know exactly what it is generated by the ORM and you are sure that the generated SQL is as well performing as what you could have written by hand.

Let me go through the most common pitfall I see.

You have a blog listing a bunch of posts: title, content, author, date and the number of comments associated. 

Typically one would do it like this:

{% highlight erb %}
- for post in @posts
<h1><%= post.title %></h1>
<p><%= post.content %></p>
<p>
  <%= post.author %> posted on <%= post.created_at %>
  <%= post.comments.count %> comments
</p>
{% endhighlight %}

This looks simple enough, and it is -- the issue here is the query for retrieving the number of comments (`post.comments.count`) associated is run for each blog post, although it could easily be included in the main SQL query fetching the posts with a join:

{% highlight sql %}
SELECT posts.*, count(comments.id) as comments_count FROM "users" INNER JOIN "comments" ON comments.post_id = posts.id GROUP BY posts.id
{% endhighlight %}

Or in Rails' ORM:

{% highlight ruby %}
Post.all(:joins => :comments, :select => "posts.*, count(comments.id) as comments_count", :group => "posts.id")
{% endhighlight %}

For a typical blog an extra 20 count queries is not critical, but once your database reaches a certain site a noticeable, avoidable, delay will occur on that page. Something that could have been avoided with a basic understanding of SQL.

ORMs are indeed very useful to developers, however you should not neglect learning SQL because you have it.

Every time you use your ORM you should stop a moment and think to yourself: "Am I sure the ORM is generating the most optimal query possible here?"
